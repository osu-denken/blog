---
title: "Jekyllに目次バーを追加する"
date: 2025-09-25
categories: []
tags: [ウェブ, Jekyll]
layout: default
---

## Jekyllとは
JekyllはGitHub Pagesにてデフォルトで利用できる静的サイトジェネレータ(SSG)です。<br>
このブログも現時点ではGitHub Pages上で動いており、Jekyllを用いて構築してます。

### 静的サイトと動的サイトについて
ところで静的サイトジェネレータとは静的サイトを生成するためのツールのことです。<br>

で、静的サイトとは、ブラウザでアクセスする(リクエストする)ごとにサーバ側(バックエンド側)で処理せずに予めサーバに用意しているHTML、CSS、JSなどをそのまま返すだけのサイトです。<br>
すなわち、その逆は動的サイトであり、リクエストするごとにバックエンド側で処理して出力したものを返します。<br><br>
例えば、<strong>静的サイト</strong>は「リクエストされると既に用意してあるプリントを渡す」、<strong>動的サイト</strong>は「リクエストされてからプリントを印刷して渡す」かの違いといえばわかりやすいでしょうか。
<br><br>
ブログの多くは基本的には動的サイトで例えばWordPressといったPHP言語製のCMS(コンテンツ管理システム)などのソフトウェアが使われています。
<br><br>
それに対して静的サイトはGo言語製のHugoやRuby言語製のJekyllががあります。
<br>
どちらもMarkdownや一部のHTMLといった記法を用いて記事を作成できます。

## 目次の追加

{% include card.html url="https://github.com/allejo/jekyll-toc" title="allejo/jekyll-toc - GitHub" description="A GitHub Pages compatible Table of Contents generator without a plugin or JavaScript" %}

上記のjekyll-tocリポジトリにある [_includes/toc.html](https://github.com/allejo/jekyll-toc/blob/master/_includes/toc.html) を構築したjekyllの_includesフォルダに<strong>toc.html</strong>保存します。

## 右に目次用のバーを追加する
電研のdenken-jekyllリポジトリの `layouts/default.html` は下記の通りである。<br>
`_includes/rightbar.html` として右の目次バー用のhtmlを作成してもよかったが、取り合えず、`default.html`にて追加しておく。

- default.html
```html
{% raw %}<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: "ja" }}">

  {%- include head.html -%}

  <body>
    
    {% include navbar.html %}

    <div class="container">
      <main class="page-content" aria-label="Content">
        <div class="wrapper">
          <h1>{{ page.title }}</h1>
          {{ content }}
        </div>
      </main>
      <aside class="rightbar">{%- include toc.html html=content sanitize=true -%}</aside>
    </div>

    {%- include footer.html -%}

  </body>

</html>{% endraw %}
```

aside.rightbarタグ内の `{% raw %}{%- include toc.html html=content sanitize=true -%}{% endraw %}` は目次そのものである。<br>
_includesに保存しておいたtoc.htmlをincludeし、htmlパラメータにcontent(html変換後の記事の内容)を指定し、sanitizeをtrueにすることで二重アンカにならないようにプレーンテキストにサニタイズしておく。<br><br>
これで右バーへ目次を追加できた。

cssは以下の通りだ。
```css
.container {
  display: flex;
  flex-direction: row;
  align-items: flex-start;
}

.page-content {
  flex: 1 1 0%;
  min-width: 0;
}

.rightbar {
  width: 300px;
  max-width: 30vw;
  margin-left: 2rem;
  background: #f8f9fa;
  border-left: 1px solid #e0e0e0;
  padding: 1rem;
  overflow-y: auto;
  height: auto;
  position: sticky;
  top: 50px;
  box-sizing: border-box;
}

.rightbar:empty {
  display: none !important;
}
```

.rightbar:empty はタグ内にまったく要素がない、空であるときdisplay: noneにする、つまり何も入っていない、目次がない場合は右バーrightbarを非表示にする。<br>

## 目次を生成しているのにも関わらず、空にならない
rightbar内には謎の改行が入っていました<br>
後ほどいろいろと確認してみると `_includes/toc.html` に原因でした。<br><br>
{% raw %}
まず、先頭行の`{% capture tocWorkspace %}`、最終行の`{% endcapture %}{% assign tocWorkspace = '' %}{{ deprecation_warnings }}{{ jekyll_toc -}}`をそれぞれ`{%- capture tocWorkspace -%}`、`{%- endcapture -%}{%- assign tocWorkspace = '' -%}{{ deprecation_warnings }}{{ jekyll_toc -}}` にします。<br>
つまり `{% ... %}` を `{%- ... -%}` のようにハイフンを付け加えます。<br>
{% endraw %}

### 何をしているのか (空白制御)
ハイフンを付け加えることでWhitespace Control (空白制御) ができます。<br>
これは改行や空白を除去できる機能です。

表記をまとめると
| フォーマット | 説明 |
| ------------ | ----------- |
| `{% raw %}{% ... %}{% endraw %}` | デフォルト |
| `{% raw %}{%- ... %}{% endraw %}` | 前の空白を除去 |
| `{% raw %}{% ... -%}{% endraw %}` | 後の空白を除去 |
| `{% raw %}{%- ... -%}{% endraw %}` | 前後の空白を除去 |

これで正常に空となり、.rightbar:emptyが機能するようになりました。
